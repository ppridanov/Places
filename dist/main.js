!function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";r.r(t);const n=new class{constructor(e){this.baseUrl=e.baseUrl,this.headers=e.headers}render(){return fetch(`${this.baseUrl}/users/me`,{method:"GET",headers:this.headers}).then(e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)).catch(e=>{console.log(e)})}loadCards(){return fetch(`${this.baseUrl}/cards`,{method:"GET",headers:this.headers}).then(e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)).catch(e=>{console.log(e)})}editProfile(e,t){return fetch(`${this.baseUrl}/users/me`,{method:"PATCH",headers:this.headers,body:JSON.stringify({name:e,about:t})}).then(e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)).catch(e=>{console.log(e)}).finally(()=>{o(!1)})}addNewCard(e,t){return fetch(`${this.baseUrl}/cards`,{method:"POST",headers:this.headers,body:JSON.stringify({name:e,link:t})}).then(e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)).catch(e=>{console.log(e)})}deleteCard(e){fetch(`${this.baseUrl}/cards/${e}`,{method:"DELETE",headers:this.headers})}}({baseUrl:"http://95.216.175.5/cohort4",headers:{authorization:"f2b2d9fc-5bcc-4fee-b5ce-de49f9685c7c","Content-Type":"application/json"}});class a{constructor(e,t,r,n){this.cardContainer=this.create(e,t,r),this.cardContainer.querySelector(".place-card__like-icon").addEventListener("click",this.like),this.cardContainer.querySelector(".place-card__delete-icon").addEventListener("click",e=>{n==a&&this.remove(e)}),this.cardContainer.querySelector(".place-card__image").addEventListener("click",this.image);const a="dd676ed20153929086e2fd3c";if(n!=a){const e=this.cardContainer.querySelector(".place-card__delete-icon");e.classList.remove("place-card__delete-icon"),e.classList.add("place-card__delete-icon_not-my")}}create(e,t,r){const n=document.createElement("div");n.classList.add("place-card");const a=`\n      <div class='place-card__container-image' _id='${r}'>\n      <div class='place-card__image' style='background-image: url(${t})'></div>\n        <button class='place-card__delete-icon'></button>\n      </div>\n      <div class='place-card__description'>\n        <h3 class='place-card__name'>${e}</h3>\n        <button class='place-card__like-icon'></button>\n      </div>\n    `;return n.innerHTML=a,n}like(e){e.target.classList.toggle("place-card__like-icon_liked")}remove(e){if(confirm("Вы уверены что хотите удалить файл?")){let t=e.target.closest(".place-card__container-image");n.deleteCard(t.getAttribute("_id")),s.removeChild(e.target.closest(".place-card"))}}image(e){const t=document.querySelector(".popup__big-image"),r=document.querySelector(".popup__image-container"),n=e.target.getAttribute("style").slice(22,-1),a=document.createElement("img");a.setAttribute("src",`${n}`),a.classList.add("popup__image");const o=document.createElement("button");o.classList.add("popup__close"),r.appendChild(a,o),t.classList.add("popup_is-opened")}}function o(e){const t=document.querySelector(".popup__button");t.textContent=e?"Загрузка...":"Сохранить"}const s=document.querySelector(".places-list"),c=(document.querySelectorAll(".place-card__image"),document.querySelector(".popup__input_type_author")),i=document.querySelector(".popup__input_type_job"),d=document.querySelector(".popup__input_type_name"),l=document.querySelector(".popup__input_type_link"),u=document.querySelectorAll(".popup__button"),p=new class{constructor(e){this.container=e,this.arrayCard=[]}add(e,t){n.addNewCard(e,t).then(e=>{let t=e.name,r=e.link,n=e._id;const o=new a(t,r,n);this.arrayCard.push(o),this.container.appendChild(o.cardContainer)})}render(){s.innerHTML="",n.loadCards().then(e=>{this.arrayCard=e,this.arrayCard.forEach((function(e){const t=new a(e.name,e.link,e._id,e.owner._id);s.appendChild(t.cardContainer)}))})}}(s),h=new class{constructor(){n.render().then(e=>{const t=e.name,r=e.about;this.render(t,r)})}render(e,t){const r=document.forms.edit,n=r.elements.author,a=r.elements.job;n.value=e,a.value=t;const o=document.querySelector(".user-info__name"),s=document.querySelector(".user-info__job");o.textContent=e,s.textContent=t}},m=new class{constructor(){document.body.addEventListener("click",e=>{e.target.classList.contains("popup__close")&&this.close(e)}),document.body.addEventListener("click",e=>{e.target.classList.contains("user-info_button")&&this.open(e),e.target.classList.contains("user-info__add-button")&&_.checkPlaceForm,e.target.classList.contains("user-info__edit-button")&&_.checkEditForm})}open(e){this.target=e.target;const t=this.target.dataset.target,r=document.getElementById(t);_.checkEditForm,_.checkPlaceForm,r.classList.add("popup_is-opened")}close(e){if(this.target=e.target.parentNode.parentNode,this.target.classList.remove("popup_is-opened"),this.target.classList.contains("popup__big-image")){const e=document.querySelector(".popup__image-container"),t=document.querySelector(".popup__image");e.removeChild(t)}}},_=new class{constructor(){let e=document.forms.edit,t=document.forms.new;c.addEventListener("input",t=>{this.handleValidate(t),this.checkEditForm(e,u)}),i.addEventListener("input",t=>{this.handleValidate(t),this.checkEditForm(e,u)}),d.addEventListener("input",e=>{this.handleValidate(e),this.checkPlaceForm(t)}),l.addEventListener("input",e=>{this.handleValidate(e),this.checkPlaceForm(t)}),e.addEventListener("submit",this.submitForm),t.addEventListener("submit",this.submitForm)}handleValidate(e){this.resetError(e.target)}validate(e){let t=document.querySelectorAll(".popup__button");const r="Это обязательное поле",n="Должно быть от 2 до 30 символов",a="Здесь должна быть ссылка",o=document.querySelector(`.error__${e.name}`);return e.checkValidity()?this.linkValidate(e)?e.name!=t[0].name&&e.name===d.name&&(e.value.length<=1||e.value.length>=30)?(o.textContent=n,this.activateError(e),!1):(this.enableButton(),!0):(o.textContent=a,this.activateError(e),!1):(o.textContent=r,this.activateError(e),!1)}linkValidate(e){if(e.name!=l.name)return!0;return!!e.value.match(/http/)&&(this.resetError(l),!0)}activateError(e){e.parentNode.classList.add("popup__input-container_invalid")}resetError(e){e.parentNode.classList.remove("popup__input-container_invalid"),e.textContent=""}enableButton(){u.forEach(e=>{e.classList.add("popup__save-button"),e.removeAttribute("disabled")})}disableButton(){u.forEach(e=>{e.classList.remove("popup__save-button"),e.setAttribute("disabled",!0)})}checkPlaceForm(e){let t=!0;return console.log(e),Array.from(e.elements).forEach(e=>{this.validate(e)||(t=!1)}),t?(this.enableButton(),!0):(this.disableButton(),!1)}checkEditForm(e,t){let r=!0;return Array.from(e.elements).forEach(e=>{e!=t&&(this.validate(e)||(r=!1))}),r?(this.enableButton(),!0):(this.disableButton(),!1)}submitForm(e){e.preventDefault();let t=document.forms.edit,r=document.forms.new;e.target.className==r.className?_.checkPlaceForm&&(p.add(r.elements.name.value,r.elements.link.value),m.close(e)):_.checkEditForm&&(o(!0),n.editProfile(t.elements.author.value,t.elements.job.value).then(t=>{m.close(e)}),h.render(t.elements.author.value,t.elements.job.value))}};n.loadCards(),n.render(),p.render()}]);